# HTTP-services TelegramAPI (1.0.1.3)

## Оглавление

[Изменения](#изменения)

[Общая информация](#общая-информация)

---

- [Доступность сервиса](#service-available)

- [Доступ пользователю](#user-access)

- [Проверка доступа пользователя](#user-access-check)

- [Объекты контрагента](#customers-facilities)

- [Контактные лица объектов контрагентов](#contact-persons-of-customers-facilities)

- [Список компаний](#list-of-companies)

- [Номенклатура заявок на доставку](#products-list-delivery)

- [Заявка на доставку](#delivery-request)

- [Получение файлов](#files)
---

## Изменения

Изменения в описании отменчены следующим образом (\*)

В версии 1.0.1.3 дополнен сервис [Номенклатура заявок на доставку](#products-list-delivery), добавлен новый [Получение файлов](#files).

В версии 1.0.1.2 добавлены сервисы [Номенклатура заявок на доставку](#products-list-delivery), [Заявка на доставку](#delivery-request).

## Общая информация

При возращении ответа с кодом 204 смотри заголовок "X-data-notice", в нем будет пояснение.

---

## Service available

### Описание

Предназначен для проверки доступности сервиса.

Метод - **GET**

### Описание шаблона

**_URL_**:

```html
https://server.ru/tgApp/v1/ping
```

Тело ответа содержит _JSON_ с следующими параметрами:

| Параметры                             |           Тип            | Обязательный | Описание                           |
| ------------------------------------- | :----------------------: | :----------: | :--------------------------------- |
| [result](#result-доступность-сервиса) | NULL, либо данные ответа |      Да      | Не заполняется при ошибке (null)   |
| error                                 |          Строка          |      Да      | Строка описания ошибки             |
| errorCode                             |          Строка          |      Да      | Код ошибки в классификации API     |
| notice                                |          Строка          |      Да      | Текст с дополнительной информацией |

#### **result (Доступность сервиса):**

| Параметры |  Тип   | Обязательный | Описание                                      |
| --------- | :----: | :----------: | :-------------------------------------------- |
| text      | Строка |      Да      | Возвращает "ok" при успешном соединении       |
| ver       | Строка |      Да      | Возвращает строковое представление версии API |

### Пример

**Ответ в формате _JSON_**:

```json
{
  "result": {
    "text": "ok",
    "ver": "1.0.1.1"
  },
  "error": null,
  "errorCode": null,
  "notice": null
}
```

---

## User access

### Описание

Предназначен для предоставления доступа пользователю телеграм

Метод - **POST**

### Описание шаблона

**_URL_**:

```html
https://server.ru/tgApp/v1/users/newAccess?userID={userID}
```

где userID - идентификатор пользователя, https://core.telegram.org/bots/api#user поле id

Тело запроса содержит _JSON_ с следующими параметрами:

| Параметры |  Тип   | Обязательный | Описание  |
| --------- | :----: | :----------: | :-------- |
| surname   | Строка |     Нет      | Фамилия   |
| name      | Строка |      да      | Имя       |
| inn       | Строка |      Да      | ИНН       |
| post      | Строка |     Нет      | Должность |

Тело ответа содержит _JSON_ с следующими параметрами:

| Параметры |     Тип      | Обязательный | Описание                                                                   |
| --------- | :----------: | :----------: | :------------------------------------------------------------------------- |
| result    | NULL, Строка |      Да      | Возвращается "ok" при успешной обработке. Не заполняется при ошибке (null) |
| error     |    Строка    |      Да      | Строка описания ошибки                                                     |
| errorCode |    Строка    |      Да      | Код ошибки в классификации API                                             |
| notice    |    Строка    |      Да      | Текст с дополнительной информацией                                         |

### Пример

**Тело запроса в формате _JSON_**:

```json
{
  "surname": "Иванов",
  "name": "Иван",
  "inn": "500100732259",
  "post": "Менеджер"
}
```

**Ответ в формате _JSON_**:

в случае ошибки:

```json
{
  "result": null,
  "error": "Не заполнены обязательные поля: Параметр URL (userID) не найден или пустой",
  "errorCode": "ValidParam",
  "notice": null
}
```

успешная обработка:

```json
{
  "result": "ok",
  "error": null,
  "errorCode": null,
  "notice": null
}
```

---

## User access check

### Описание

Предназначен для проверки наличия доступа у пользователя телеграм в 1С

Метод - **GET**

### Описание шаблона

**_URL_**:

```html
https://server.ru/tgApp/v1/users/access?userID={userID}
```

где userID - идентификатор пользователя, https://core.telegram.org/bots/api#user поле id

Тело ответа содержит _JSON_ с следующими параметрами:

| Параметры                                       |           Тип            | Обязательный | Описание                           |
| ----------------------------------------------- | :----------------------: | :----------: | :--------------------------------- |
| [result](#result-проверка-доступа-пользователя) | NULL, либо данные ответа |      Да      | Не заполняется при ошибке (null)   |
| error                                           |          Строка          |      Да      | Строка описания ошибки             |
| errorCode                                       |          Строка          |      Да      | Код ошибки в классификации API     |
| notice                                          |          Строка          |      Да      | Текст с дополнительной информацией |

#### **result (Проверка доступа пользователя):**

| Параметры     |  Тип   | Обязательный | Описание                                                                                     |
| ------------- | :----: | :----------: | :------------------------------------------------------------------------------------------- |
| access        | Булево |      Да      | Возвращает "true" если доступ разрешен, иначе "false"                                        |
| accessReguest | Булево |      Да      | Возвращает "true" если был запрос [Доступ пользователю](#доступ-пользователю), иначе "false" |

### Пример

**Ответ в формате _JSON_**:

```json
{
  "result": {
    "access": true,
    "accessReguest": true
  },
  "error": null,
  "errorCode": null,
  "notice": null
}
```

---

## Customers facilities

### Описание

Предназначен для получения списка объектов контрагента

Метод - **GET**

### Описание шаблона

**_URL_**:

```html
https://server.ru/tgApp/v1/clients/clientObjects/list?clientID={clientID}
```

где clientID - Идентификатор контрагента

Тело ответа содержит _JSON_ с следующими параметрами:

| Параметры                             |           Тип            | Обязательный | Описание                           |
| ------------------------------------- | :----------------------: | :----------: | :--------------------------------- |
| [result](#result-объекты-контрагента) | NULL, либо данные ответа |      Да      | Не заполняется при ошибке (null)   |
| error                                 |          Строка          |      Да      | Строка описания ошибки             |
| errorCode                             |          Строка          |      Да      | Код ошибки в классификации API     |
| notice                                |          Строка          |      Да      | Текст с дополнительной информацией |

#### **result (Объекты контрагента):**

| Параметры |  Тип   | Обязательный | Описание                          |
| --------- | :----: | :----------: | :-------------------------------- |
| name      | Строка |      Да      | Наименование объекта контрагента  |
| id        | Строка |      Да      | Идентификатор объекта контрагента |

### Пример

**_URL_**:

```html
https://server.ru/tgApp/v1/clients/clientObjects/list?clientID=00-000092
```

**Ответ в формате _JSON_**:

```json
{
  "result": [
    {
      "name": "Офис",
      "id": "000000014"
    },
    {
      "name": "Отчистные сооружения г. Люберцы",
      "id": "000000015"
    },
    {
      "name": "Склад",
      "id": "000000016"
    }
  ],
  "error": null,
  "errorCode": null,
  "notice": null
}
```

---

## Contact persons of customers facilities

### Описание

Предназначен для получения списка контактных лиц объектов контрагентов

Метод - **GET**

### Описание шаблона

**_URL_**:

```html
https://server.ru/tgApp/v1/clientObjects/contacts?objectID={objectID}
```

где objectID - Идентификатор объекта контрагента

Тело ответа содержит _JSON_ с следующими параметрами:

| Параметры                                               |           Тип            | Обязательный | Описание                           |
| ------------------------------------------------------- | :----------------------: | :----------: | :--------------------------------- |
| [result](#result-контактные-лица-объектов-контрагентов) | NULL, либо данные ответа |      Да      | Не заполняется при ошибке (null)   |
| error                                                   |          Строка          |      Да      | Строка описания ошибки             |
| errorCode                                               |          Строка          |      Да      | Код ошибки в классификации API     |
| notice                                                  |          Строка          |      Да      | Текст с дополнительной информацией |

#### **result (Контактные лица объектов контрагентов):**

| Параметры |  Тип   | Обязательный | Описание                       |
| --------- | :----: | :----------: | :----------------------------- |
| fio       | Строка |      Да      | ФИО контактного лица           |
| id        | Строка |      Да      | Идентификатор контактного лица |

### Пример

**_URL_**:

```html
https://server.ru/tgApp/v1/clientObjects/contacts?objectID=000000557
```

**Ответ в формате _JSON_**:

```json
{
  "result": [
    {
      "fio": "Яковлев Сергей Александрович",
      "id": "000002051"
    },
    {
      "fio": "Астахов Александр Сергеевич",
      "id": "000002052"
    }
  ],
  "error": null,
  "errorCode": null,
  "notice": null
}
```

---

## List of companies

### Описание

Предназначен для получения списка компаний

Метод - **GET**

### Описание шаблона

**_URL_**:

```html
https://server.ru/tgApp/v1/digitalCompanies/clients/list?userID={userID}
```

где userID - Идентификатор пользователя или идентификатор контактного лица

Тело ответа содержит _JSON_ с следующими параметрами:

| Параметры                         |           Тип            | Обязательный | Описание                           |
| --------------------------------- | :----------------------: | :----------: | :--------------------------------- |
| [result](#result-список-компаний) | NULL, либо данные ответа |      Да      | Не заполняется при ошибке (null)   |
| error                             |          Строка          |      Да      | Строка описания ошибки             |
| errorCode                         |          Строка          |      Да      | Код ошибки в классификации API     |
| notice                            |          Строка          |      Да      | Текст с дополнительной информацией |

#### **result (Список компаний):**

| Параметры |  Тип   | Обязательный | Описание                      |
| --------- | :----: | :----------: | :---------------------------- |
| name      | Строка |      Да      | Наименование личного кабинета |
| id        | Строка |      Да      | Идентификатор контрагента     |

### Пример

**_URL_**:

```html
https://server.ru/tgApp/v1/digitalCompanies/clients/list?userID=000001935
```

**Ответ в формате _JSON_**:

```json
{
  "result": [
    {
      "name": "СТРОЙУНИВЕРСАЛ ООО",
      "id": "НФ-001776"
    },
    {
      "name": "СТРОЙУНИВЕРСАЛ ООО",
      "id": "НФ-002674"
    },
    {
      "name": "СТРОЙУНИВЕРСАЛ ООО",
      "id": "НФ-003608"
    }
  ],
  "error": null,
  "errorCode": null,
  "notice": null
}
```

---

## Products list delivery

### Описание

Предназначен для получения списка номенклатур предназначенных для заявки на доставку

Метод - **GET**

### Описание шаблона

**_URL_**:

```html
https://server.ru/tgApp/v1/products/delivery
```

Тело ответа содержит _JSON_ с следующими параметрами:

| Параметры                             |           Тип            | Обязательный | Описание                           |
| ------------------------------------- | :----------------------: | :----------: | :--------------------------------- |
| [result](#result-список-инструментов) | NULL, либо данные ответа |      Да      | Не заполняется при ошибке (null)   |
| error                                 |          Строка          |      Да      | Строка описания ошибки             |
| errorCode                             |          Строка          |      Да      | Код ошибки в классификации API     |
| notice                                |          Строка          |      Да      | Текст с дополнительной информацией |

#### **result (Список инструментов):**

| Параметры        |  Тип   | Обязательный | Описание                            |
| ---------------- | :----: | :----------: | :---------------------------------- |
| uID              | Строка |      Да      | Идентификатор инструмента           |
| name             | Строка |      Да      | Наименование инструмента            |
| mainImageID (\*) | Строка |      Да      | Идентификатор основного изображения |

### Пример

**_URL_**:

```html
https://server.ru/tgApp/v1/products/delivery
```

**Ответ в формате _JSON_**:

```json
{
  "result": [
    {
      "uID": "НФ-00254505",
      "name": "УШМ",
      "mainImageID": ""
    },
    {
      "uID": "НФ-00254506",
      "name": "Перфоратор",
      "mainImageID": "26346acc-68e5-11ee-81cd-00155df43005"
    }
  ],
  "error": null,
  "errorCode": null,
  "notice": null
}
```

---

## Delivery request

### Описание

Предназначен для создания документов Заявка на доставку в 1С

Метод - **POST**

### Описание шаблона

**_URL_**:

```html
https://server.ru/tgApp/v1/delivery/request
```

Тело запроса содержит _JSON_ с следующими параметрами:

| Параметры                               |   Тип   | Обязательный | Описание                                                                                                            |
| --------------------------------------- | :-----: | :----------: | :------------------------------------------------------------------------------------------------------------------ |
| clientID                                | Строка  |      Да      | Идентификатор контрагента, см. [Список компаний](#список-компаний)                                                  |
| clientObjectID                          | Строка  |      да      | Идентификатор объекта контрагента, см. [Объекты контрагента](#объекты-контрагента)                                  |
| contactID                               | Строка  |      Да      | Идентификатор контактного лица, см. [Контактные лица объектов контрагентов](#контактные-лица-объектов-контрагентов) |
| [products](#product-заявка-на-доставку) | Объекта |      Да      | Массив инструментов                                                                                                 |

#### **product (Заявка на доставку):**

| Параметры |  Тип   | Обязательный | Описание                                                                   |
| --------- | :----: | :----------: | :------------------------------------------------------------------------- |
| uID       | Строка |      Да      | Идентификатор инструмента, см. [Список инструментов](#список-инструментов) |
| quantity  | Число  |      Да      | Количество                                                                 |

Тело ответа содержит _JSON_ с следующими параметрами:

| Параметры |     Тип      | Обязательный | Описание                                                                   |
| --------- | :----------: | :----------: | :------------------------------------------------------------------------- |
| result    | NULL, Строка |      Да      | Возвращается "ok" при успешной обработке. Не заполняется при ошибке (null) |
| error     |    Строка    |      Да      | Строка описания ошибки                                                     |
| errorCode |    Строка    |      Да      | Код ошибки в классификации API                                             |
| notice    |    Строка    |      Да      | Текст с дополнительной информацией                                         |

### Пример

**_URL_**:

```html
https://server.ru/tgApp/v1/delivery/request
```

**Тело запроса в формате _JSON_**:

```json
{
  "clientID": "НФ-003467",
  "clientObjectID": "000001216",
  "contactID": "000002719",
  "products": [
    {
      "uID": "00-00000383",
      "quantity": 1
    },
    {
      "uID": "НФ-00094813",
      "quantity": 2
    }
  ]
}
```

**Ответ в формате _JSON_**:

```json
{
  "result": "ok",
  "error": null,
  "errorCode": null,
  "notice": null
}
```

---

## Files

### Описание

Предназначен для получения файлов из 1С

Метод **GET**

### Описание шаблона

**_URL_**:

```html
https://server.ru/tgApp/v1/files/{type}?guid={guid}
```

где type - productDelivery (Изображение инструмента доставки). Список типов может пополняться.

где guid уникальный идентификатор объекта в зависимости от типа (строка 36 знаков). Можно передать несколько guid-ов через запятую. См. примеры запроса ниже.

Если успешно, то возвращаются двоичные данные иначе тело ответа содержит _JSON_ с следующими параметрами:

| Параметры |  Тип   | Обязательный | Описание                                   |
| --------- | :----: | :----------: | :----------------------------------------- |
| result    |  NULL  |      Да      | Результат, для данного сервиса всегда null |
| error     | Строка |      Да      | Строка описания ошибки                     |
| errorCode | Строка |      Да      | Код ошибки в классификации API             |
| notice    | Строка |      Да      | Текст с дополнительной информацией         |

### Пример

**_URL_**:

```html
https://server.ru/tgApp/v1/files/productDelivery?guid=0266e599-68e5-11ee-81cd-00155df43005,26346acc-68e5-11ee-81cd-00155df43005
```

**Ответ**: Двоичные данные (если передано несколько guid-ов, то возвращаются двоичные данные архива .zip) или JSON в случае ошибки:

```json
{
  "result": null,
  "error": "Не удалось получить двоичные данные. Возможно передан некорректный идентификатор (guid)",
  "errorCode": "NoDataInBase",
  "notice": null
}
```

---
